# ============================================
# Cloudflare Pages è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
# GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
# 
# ãƒˆãƒªã‚¬ãƒ¼: mainãƒ–ãƒ©ãƒ³ãƒã¸ã®push
# ============================================

name: Deploy to Cloudflare Pages

on:
  push:
    branches:
      - main
  workflow_dispatch:  # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      deployments: write

    steps:
      # ============================================
      # 1. ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      # ============================================
      - name: Checkout repository
        uses: actions/checkout@v4

      # ============================================
      # 2. Cloudflare Pagesã«ãƒ‡ãƒ—ãƒ­ã‚¤
      # ============================================
      - name: Deploy to Cloudflare Pages
        uses: cloudflare/wrangler-action@v3
        with:
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
          command: pages deploy . --project-name=${{ vars.CLOUDFLARE_PROJECT_NAME || 'nfc-aika-cute' }}

      # ============================================
      # 3. ãƒ‡ãƒ—ãƒ­ã‚¤çµæœã‚’å‡ºåŠ›
      # ============================================
      - name: Output deployment URL
        run: |
          echo "ğŸ‰ Deployment completed!"
          echo "ğŸ“± Site URL: https://${{ vars.CLOUDFLARE_PROJECT_NAME || 'nfc-aika-cute' }}.pages.dev"
